<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>تفاصيل الآية - القرآن الكريم</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
        href="https://fonts.googleapis.com/css2?family=Amiri:ital,wght@0,400;0,700;1,400&family=Cairo:wght@400;500;600;700&family=Noto+Naskh+Arabic:wght@400;700&display=swap"
        rel="stylesheet" />

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class', // Enable class-based dark mode
            theme: {
                extend: {
                    colors: {
                        brand: {
                            light: '#FFFBEB',
                            DEFAULT: '#1B4332',
                            dark: '#0f291e',
                            gold: '#D4AF37',
                        }
                    },
                    fontFamily: {
                        sans: ['Cairo', 'sans-serif'],
                        serif: ['Amiri', 'serif'],
                    }
                }
            }
        }
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            outline: none;
        }

        :root {
            --background: #FDFBF7;
            --foreground: #1B4332;
            --accent: #D4AF37;
            --ayah-font-size: 2.8rem;
            --ayah-line-height: 2.2;
        }

        body {
            background-color: #f5f3ef;
            color: var(--foreground);
            font-family: "Noto Naskh Arabic", "Amiri", serif;
            min-height: 100vh;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
        }

        .main-card {
            background: #fdfcfb;
            border-radius: 24px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.03);
            padding: 3rem 2rem;
            margin: 2rem 1rem;
            position: relative;
            border: 1px solid #ebe8e1;
            text-align: center;
        }

        .main-card::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, #1B4332, #D4AF37);
            border-radius: 24px 24px 0 0;
        }

        .ayah-large {
            font-family: "Amiri", serif;
            font-size: var(--ayah-font-size);
            line-height: var(--ayah-line-height);
            color: #1B4332;
            margin-bottom: 2rem;
        }

        .surah-tag {
            display: inline-flex;
            align-items: center;
            padding: 0.5rem 1.5rem;
            background: rgba(212, 175, 55, 0.1);
            color: #D4AF37;
            border-radius: 99px;
            font-family: "Cairo", sans-serif;
            font-weight: 600;
            margin-bottom: 2rem;
            font-size: 0.9rem;
        }

        .audio-player-container {
            background: #fdfcfb;
            border: 1px solid #ebe8e1;
            border-radius: 20px;
            padding: 1.5rem 2rem;
            margin-top: 2rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.03);
        }

        .audio-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 0.5rem;
        }

        .audio-time {
            font-family: "Cairo", sans-serif;
            font-size: 0.85rem;
            color: #64748b;
            min-width: 45px;
            text-align: center;
        }

        .progress-container {
            flex: 1;
            height: 6px;
            background: #e5e7eb;
            border-radius: 999px;
            overflow: hidden;
            cursor: pointer;
            position: relative;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #1B4332, #2D5A46);
            border-radius: 999px;
            width: 0%;
            transition: width 0.1s linear;
        }

        .control-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            color: #64748b;
        }

        .control-btn:hover {
            background: #f1f5f9;
            color: #1B4332;
        }

        .control-btn svg {
            width: 20px;
            height: 20px;
        }

        .play-btn {
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, #1B4332, #2D5A46);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(27, 67, 50, 0.25);
            border: none;
        }

        .play-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 16px rgba(27, 67, 50, 0.35);
        }

        .play-btn svg {
            width: 24px;
            height: 24px;
            fill: currentColor;
        }

        .reciter-name {
            text-align: center;
            color: #94a3b8;
            font-size: 0.85rem;
            font-family: "Cairo", sans-serif;
            margin-top: 0.5rem;
        }

        .tafsir-section {
            margin-top: 3rem;
            text-align: right;
        }

        .tafsir-tabs {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .tafsir-tab {
            padding: 0.6rem 1.8rem;
            border-radius: 12px;
            font-family: "Cairo", sans-serif;
            font-weight: 600;
            font-size: 0.95rem;
            color: #64748b;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid #ebe8e1;
            background: #fdfcfb;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.03);
        }

        .tafsir-tab.active {
            background: linear-gradient(135deg, #1B4332, #2D5A46);
            color: white;
            border-color: #1B4332;
            box-shadow: 0 4px 12px rgba(27, 67, 50, 0.25);
            transform: translateY(-1px);
        }

        .tafsir-tab:hover:not(.active) {
            background: #f8fafc;
            color: #1B4332;
            border-color: #cbd5e1;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .tafsir-content {
            line-height: 1.8;
            color: #4b5563;
            font-size: 1.1rem;
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid #ebe8e1;
        }
    </style>
</head>

<body class="bg-[#FDFBF7] text-[#1B4332]">

    <!-- Header -->
    <header class="bg-[#1B4332] text-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto max-w-6xl px-3 md:px-6 py-3 flex justify-between items-center dir-rtl">
            <!-- Logo (Clickable to go to Home) -->
            <div onclick="window.location.href='index.html'"
                class="flex items-center gap-2 md:gap-3 hover:opacity-80 transition-opacity cursor-pointer">
                <div class="bg-[#2D5A46] p-2 rounded-xl border border-[#4A7C66]">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 md:h-6 md:w-6 text-white" fill="none"
                        viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                    </svg>
                </div>
                <div class="hidden sm:block">
                    <h1 class="text-base md:text-lg font-bold font-serif leading-none">القرآن الكريم</h1>
                    <span class="text-[10px] text-gray-300 opacity-80">القراءة والتدبر</span>
                </div>
            </div>

            <!-- Nav Links -->
            <div class="flex items-center gap-3 md:gap-6 text-sm">
                <!-- Home Button - Icon on mobile, text on desktop -->
                <a href="index.html"
                    class="bg-[#3A6B56] text-white px-3 md:px-4 py-1.5 rounded-full font-medium flex items-center gap-1.5">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 md:hidden" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                    </svg>
                    <span class="hidden md:inline">الرئيسية</span>
                    <span class="md:hidden text-xs">الرئيسية</span>
                </a>
                <a href="search.html" class="flex items-center gap-2 text-gray-300 hover:text-white">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                    <span class="hidden md:inline">البحث</span>
                </a>
                <a href="favorites.html" class="flex items-center gap-2 text-gray-300 hover:text-white">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                    </svg>
                    <span class="hidden md:inline">المفضلة</span>
                </a>

                <div class="h-5 w-px bg-white/20 mx-1 hidden md:block"></div>

                <!-- Settings Button -->
                <button onclick="toggleSettings()"
                    class="text-gray-300 hover:text-white hover:rotate-90 transition-all duration-300">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 md:h-6 md:w-6" fill="none"
                        viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                </button>
            </div>
        </div>
    </header>

    <!-- Breadcrumb & Selectors -->
    <div class="bg-white border-b border-gray-100 sticky top-[57px] z-40">
        <div
            class="container mx-auto max-w-6xl px-4 md:px-6 py-3 flex flex-col md:flex-row gap-3 md:gap-0 justify-between items-stretch md:items-center">
            <!-- Breadcrumb (Right) -->
            <nav id="breadcrumb" class="hidden md:flex items-center gap-2 text-sm text-gray-500">
                <a href="index.html" class="hover:text-[#1B4332] transition-colors">الرئيسية</a>
                <span>•</span>
                <span id="breadcrumbSurah"
                    class="text-[#1B4332] font-semibold cursor-pointer hover:underline">...</span>
                <span>•</span>
                <span id="breadcrumbAyah" class="text-[#1B4332] font-semibold">...</span>
            </nav>

            <!-- Selectors (Left) -->
            <div class="flex flex-col md:flex-row items-stretch md:items-center gap-3 w-full md:w-auto">
                <!-- Ayah Selector -->
                <div class="relative w-full md:w-auto">
                    <button id="ayahSelectorBtn"
                        class="flex items-center gap-2 px-4 py-2 bg-white border border-gray-200 rounded-lg hover:border-[#1B4332] transition-all focus:outline-none focus:ring-2 focus:ring-[#1B4332]/20 w-full md:min-w-[120px]">
                        <span class="text-gray-600 text-xs">الآية</span>
                        <span id="currentAyahNumber" class="flex-1 text-center font-bold text-[#1B4332]">...</span>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-400 transition-transform"
                            id="ayahDropdownArrow" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                        </svg>
                    </button>

                    <!-- Ayah Dropdown -->
                    <div id="ayahDropdown"
                        class="hidden absolute left-0 right-0 md:right-auto mt-2 md:w-72 bg-white border border-gray-200 rounded-lg shadow-xl max-h-[350px] overflow-y-auto z-50">
                        <div id="ayahList" class="p-2">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- Surah Selector -->
                <div class="relative w-full md:w-auto">
                    <button id="surahSelectorBtn"
                        class="flex items-center gap-3 px-4 py-2 bg-white border border-gray-200 rounded-lg hover:border-[#1B4332] transition-all focus:outline-none focus:ring-2 focus:ring-[#1B4332]/20 w-full md:min-w-[200px]">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-[#1B4332]" fill="none"
                            viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                        </svg>
                        <span id="currentSurahName" class="flex-1 text-right font-semibold text-[#1B4332]">...</span>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-400 transition-transform"
                            id="surahDropdownArrow" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                        </svg>
                    </button>

                    <!-- Surah Dropdown Menu -->
                    <div id="surahDropdown"
                        class="hidden absolute left-0 right-0 md:right-auto mt-2 md:w-80 bg-white border border-gray-200 rounded-lg shadow-xl max-h-[400px] overflow-hidden z-50">
                        <!-- Search Box -->
                        <div class="p-3 border-b border-gray-100">
                            <input type="text" id="surahSearch" placeholder="ابحث عن سورة..."
                                class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#1B4332]/20 text-right" />
                        </div>

                        <!-- Surah List -->
                        <div id="surahList" class="overflow-y-auto max-h-[340px]">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <main class="container mx-auto max-w-4xl flex-grow">

        <div id="loading" class="flex flex-col items-center justify-center min-h-[50vh]">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-[#1B4332] mb-4"></div>
        </div>

        <div id="content" class="hidden">

            <div class="main-card animate-fade-in-up">
                <span class="surah-tag" id="surahNameTag">...</span>

                <div id="ayahText" class="ayah-large">
                    ...
                </div>

                <div class="flex justify-center mt-6">
                    <span
                        class="bg-[#D4AF37] text-white w-8 h-8 rounded-full flex items-center justify-center font-bold font-serif"
                        id="ayahNumBadge">1</span>
                </div>

                <div class="audio-player-container">
                    <div class="text-right mb-2">
                        <span class="text-sm text-gray-500 font-serif">الاستماع للآية</span>
                    </div>
                    <div class="audio-controls">
                        <button id="replayBtn" class="control-btn" title="إعادة">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                            </svg>
                        </button>

                        <span id="currentTime" class="audio-time">0:00</span>

                        <div class="progress-container" id="progressContainer">
                            <div id="progressBar" class="progress-bar"></div>
                        </div>

                        <span id="duration" class="audio-time">0:00</span>

                        <button id="playBtn" class="play-btn">
                            <svg id="playIcon" viewBox="0 0 24 24">
                                <path d="M8 5v14l11-7z" />
                            </svg>
                            <svg id="pauseIcon" class="hidden" viewBox="0 0 24 24">
                                <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z" />
                            </svg>
                        </button>
                    </div>
                    <div class="reciter-name">مصحف القارئ مشاري راشد العفاسي</div>
                </div>
            </div>

            <!-- Navigation Between Ayahs -->
            <div class="mt-8 mb-8">
                <!-- Top Line with Star -->
                <div class="flex items-center justify-center gap-4 mb-6">
                    <div class="flex-1 h-px bg-gray-200"></div>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-[#D4AF37]" fill="currentColor"
                        viewBox="0 0 24 24">
                        <path
                            d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" />
                    </svg>
                    <div class="flex-1 h-px bg-gray-200"></div>
                </div>

                <!-- Buttons Row -->
                <div class="flex items-center justify-center gap-6">
                    <button id="nextAyahBtn"
                        class="nav-btn group flex items-center gap-2 bg-[#fdfcfb] text-[#1B4332] border-[#ebe8e1]">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24"
                            stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                        </svg>
                        <span id="nextAyahText" class="text-sm">آية تالية</span>
                    </button>

                    <a href="" id="surahIndexBtn"
                        class="nav-btn group flex items-center gap-2 bg-[#fdfcfb] text-[#1B4332] border-[#ebe8e1]">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24"
                            stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                        <span class="text-sm">فهرس السورة</span>
                    </a>

                    <button id="prevAyahBtn"
                        class="nav-btn group flex items-center gap-2 bg-[#fdfcfb] text-[#1B4332] border-[#ebe8e1]">
                        <span id="prevAyahText" class="text-sm">آية سابقة</span>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24"
                            stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <div class="px-6 pb-20">
            <div class="tafsir-section">
                <h3 class="text-2xl font-bold font-serif text-[#1B4332] mb-4">التفسير</h3>
                <div class="tafsir-tabs">
                    <button class="tafsir-tab active" onclick="loadTafsirContent('ar.muyassar', this)">الميسر</button>
                    <button class="tafsir-tab" onclick="loadTafsirContent('ar.jalalayn', this)">الجلالين</button>
                    <button class="tafsir-tab" onclick="loadTafsirContent('ar.qurtubi', this)">القرطبي</button>
                    <button class="tafsir-tab" onclick="loadTafsirContent('ar.baghawi', this)">البغوي</button>
                    <button class="tafsir-tab" onclick="loadTafsirContent('ar.waseet', this)">الوسيط</button>
                </div>
                <div id="tafsirContent" class="tafsir-content">
                    جاري تحميل التفسير...
                </div>
            </div>
        </div>

        </div>
    </main>

    <!-- Footer -->
    <footer class="pt-6 pb-6 border-t" style="background-color:#f1ede499;">
        <div class="container mx-auto max-w-6xl px-6 py-12 md:py-16">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-10">
                <!-- Intro -->
                <div class="md:col-span-1">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" class="lucide lucide-book-open h-5 w-5 text-primary">
                                <path d="M12 7v14"></path>
                                <path
                                    d="M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z">
                                </path>
                            </svg>
                        </div>
                        <h3 class="font-amiri font-bold text-foreground text-xl">القرآن الكريم</h3>
                    </div>
                    <p class="text-sm text-muted-foreground leading-relaxed">موقع للقراءة والتدبر في كتاب الله الكريم مع
                        تفاسير العلماء الأجلاء. صُمم بعناية لتوفير تجربة قراءة مريحة وسهلة.</p>
                </div>

                <!-- Quick Links -->
                <div>
                    <h3 class="font-amiri font-bold text-foreground mb-4 text-lg flex items-center gap-2"><svg
                            xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="lucide lucide-star h-4 w-4 text-gold">
                            <path
                                d="M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z">
                            </path>
                        </svg>روابط سريعة</h3>
                    <ul class="space-y-3 text-sm">
                        <li><a class="text-muted-foreground hover:text-primary transition-colors flex items-center gap-2 group"
                                href="index.html"><span
                                    class="w-1.5 h-1.5 rounded-full bg-primary/30 group-hover:bg-primary transition-colors"></span>فهرس
                                السور</a></li>
                        <li><a class="text-muted-foreground hover:text-primary transition-colors flex items-center gap-2 group"
                                href="#"><span
                                    class="w-1.5 h-1.5 rounded-full bg-primary/30 group-hover:bg-primary transition-colors"></span>سورة
                                الفاتحة</a></li>
                        <li><a class="text-muted-foreground hover:text-primary transition-colors flex items-center gap-2 group"
                                href="#"><span
                                    class="w-1.5 h-1.5 rounded-full bg-primary/30 group-hover:bg-primary transition-colors"></span>سورة
                                يس</a></li>
                        <li><a class="text-muted-foreground hover:text-primary transition-colors flex items-center gap-2 group"
                                href="#"><span
                                    class="w-1.5 h-1.5 rounded-full bg-primary/30 group-hover:bg-primary transition-colors"></span>سورة
                                الملك</a></li>
                        <li><a class="text-muted-foreground hover:text-primary transition-colors flex items-center gap-2 group"
                                href="search.html"><span
                                    class="w-1.5 h-1.5 rounded-full bg-primary/30 group-hover:bg-primary transition-colors"></span>البحث
                                في القرآن</a></li>
                    </ul>
                </div>

                <!-- Tafsir List -->
                <div>
                    <h3 class="font-amiri font-bold text-foreground mb-4 text-lg flex items-center gap-2"><svg
                            xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="lucide lucide-moon h-4 w-4 text-gold">
                            <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"></path>
                        </svg>التفاسير المتوفرة</h3>
                    <ul class="space-y-3 text-sm">
                        <li><a class="text-muted-foreground hover:text-primary transition-colors flex items-center gap-2 group"
                                href="#"><span
                                    class="w-1.5 h-1.5 rounded-full bg-gold/50 group-hover:bg-gold transition-colors"></span>التفسير
                                الميسر</a></li>
                        <li><a class="text-muted-foreground hover:text-primary transition-colors flex items-center gap-2 group"
                                href="#"><span
                                    class="w-1.5 h-1.5 rounded-full bg-gold/50 group-hover:bg-gold transition-colors"></span>تفسير
                                الجلالين</a></li>
                        <li><a class="text-muted-foreground hover:text-primary transition-colors flex items-center gap-2 group"
                                href="#"><span
                                    class="w-1.5 h-1.5 rounded-full bg-gold/50 group-hover:bg-gold transition-colors"></span>تفسير
                                القرطبي</a></li>
                        <li><a class="text-muted-foreground hover:text-primary transition-colors flex items-center gap-2 group"
                                href="#"><span
                                    class="w-1.5 h-1.5 rounded-full bg-gold/50 group-hover:bg-gold transition-colors"></span>تفسير
                                البغوي</a></li>
                        <li><a class="text-muted-foreground hover:text-primary transition-colors flex items-center gap-2 group"
                                href="#"><span
                                    class="w-1.5 h-1.5 rounded-full bg-gold/50 group-hover:bg-gold transition-colors"></span>التفسير
                                الوسيط</a></li>
                    </ul>
                </div>

                <!-- Stats -->
                <div>
                    <h3 class="font-amiri font-bold text-foreground mb-4 text-lg">إحصائيات القرآن</h3>
                    <div class="grid grid-cols-2 gap-3">
                        <div class="bg-card/80 rounded-lg p-3 text-center border border-border/50">
                            <p class="font-arabic text-xl font-bold text-primary">١١٤</p>
                            <p class="text-xs text-muted-foreground">سورة</p>
                        </div>
                        <div class="bg-card/80 rounded-lg p-3 text-center border border-border/50">
                            <p class="font-arabic text-xl font-bold text-primary">٦٢٣٦</p>
                            <p class="text-xs text-muted-foreground">آية</p>
                        </div>
                        <div class="bg-card/80 rounded-lg p-3 text-center border border-border/50">
                            <p class="font-arabic text-xl font-bold text-primary">٣٠</p>
                            <p class="text-xs text-muted-foreground">جزء</p>
                        </div>
                        <div class="bg-card/80 rounded-lg p-3 text-center border border-border/50">
                            <p class="font-arabic text-xl font-bold text-primary">٦٠</p>
                            <p class="text-xs text-muted-foreground">حزب</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="border-t border-border/50 py-5" style="background-color:#f1ede499;">
            <div class="container mx-auto max-w-6xl px-6">
                <div class="flex flex-col md:flex-row items-center justify-between gap-3 text-xs text-muted-foreground">
                    <p class="font-arabic flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="24"
                            height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-book-open h-3.5 w-3.5">
                            <path d="M12 7v14"></path>
                            <path
                                d="M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z">
                            </path>
                        </svg>القرآن الكريم - القراءة والتدبر والتفسير</p>
                    <p class="opacity-60">مصدر البيانات: AlQuran.cloud · Quran.com</p>
                </div>
            </div>
        </div>
    </footer>

    <audio id="audio" preload="none"></audio>

    <script src="settings.js"></script>
    <script>
        const surahs = [
            "الفاتحة", "البقرة", "آل عمران", "النساء", "المائدة", "الأنعام", "الأعراف", "الأنفال", "التوبة", "يونس",
            "هود", "يوسف", "الرعد", "إبراهيم", "الحجر", "النحل", "الإسراء", "الكهف", "مريم", "طه",
            "الأنبياء", "الحج", "المؤمنون", "النور", "الفرقان", "الشعراء", "النمل", "القصص", "العنكبوت", "الروم",
            "لقمان", "السجدة", "الأحزاب", "سبأ", "فاطر", "يس", "الصافات", "ص", "الزمر", "غافر",
            "فصلت", "الشورى", "الزخرف", "الدخان", "الجاثية", "الأحقاف", "محمد", "الفتح", "الحجرات", "ق",
            "الذاريات", "الطور", "النجم", "القمر", "الرحمن", "الواقعة", "الحديد", "المجادلة", "الحشر", "الممتحنة",
            "الصف", "الجمعة", "المنافقون", "التغابن", "الطلاق", "التحريم", "الملك", "القلم", "الحاقة", "المعارج",
            "نوح", "الجن", "المزمل", "المدثر", "القيامة", "الإنسان", "المرسلات", "النبأ", "النازعات", "عبس",
            "التكوير", "الانفطار", "المطففين", "الانشقاق", "البروج", "الطارق", "الأعلى", "الغاشية", "الفجر", "البلد",
            "الشمس", "الليل", "الضحى", "الشرح", "التين", "العلق", "القدر", "البينة", "الزلزلة", "العاديات",
            "القارعة", "التكاثر", "العصر", "الهمزة", "الفيل", "قريش", "الماعون", "الكوثر", "الكافرون", "النصر",
            "المسد", "الإخلاص", "الفلق", "الناس"
        ];

        const urlParams = new URLSearchParams(window.location.search);
        const surah = parseInt(urlParams.get("surah"));
        const ayah = parseInt(urlParams.get("ayah"));

        const audio = document.getElementById('audio');
        const playBtn = document.getElementById('playBtn');
        const loading = document.getElementById('loading');
        const content = document.getElementById('content');

        // Default Tafsir
        let currentTafsir = 'ar.muyassar';

        async function init() {
            if (!surah || !ayah) {
                alert("خطأ في الرابط");
                return;
            }

            try {
                // Fetch Surah data from quran-json
                const response = await fetch(`https://cdn.jsdelivr.net/npm/quran-json@3.1.2/dist/chapters/${surah}.json`);
                const data = await response.json();

                if (data && data.verses) {
                    const ayahData = data.verses[ayah - 1]; // ayah is 1-indexed
                    const surahName = surahs[surah - 1];
                    const totalAyahs = data.verses.length;

                    // Update Breadcrumb and Selectors
                    document.getElementById('breadcrumbSurah').textContent = `سورة ${surahName}`;
                    document.getElementById('breadcrumbSurah').onclick = () => {
                        window.location.href = `ayahs.html?surah=${surah}&name=${encodeURIComponent(surahName)}`;
                    };
                    document.getElementById('breadcrumbAyah').textContent = `الآية ${ayah.toLocaleString('ar-EG')}`;
                    document.getElementById('currentSurahName').textContent = `سورة ${surahName}`;
                    document.getElementById('currentAyahNumber').textContent = ayah.toLocaleString('ar-EG');

                    // Populate Ayah List
                    populateAyahList(totalAyahs);

                    document.getElementById('surahNameTag').textContent = `سورة ${surahName}`;
                    document.getElementById('ayahText').textContent = ayahData.text;
                    document.getElementById('ayahNumBadge').textContent = ayah.toLocaleString('ar-EG');

                    // Audio Setup (Using EveryAyah for reliability)
                    const pad = n => n.toString().padStart(3, '0');
                    const audioUrl = `https://everyayah.com/data/Alafasy_128kbps/${pad(surah)}${pad(ayah)}.mp3`;
                    audio.src = audioUrl;

                    // Setup Navigation Buttons

                    // Surah Index Button
                    document.getElementById('surahIndexBtn').href = `ayahs.html?surah=${surah}&name=${encodeURIComponent(surahName)}`;

                    // Previous Ayah Button
                    if (ayah > 1) {
                        document.getElementById('prevAyahBtn').onclick = () => {
                            window.location.href = `ayah_detail.html?surah=${surah}&ayah=${ayah - 1}`;
                        };
                    } else {
                        document.getElementById('prevAyahBtn').classList.add('hidden');
                    }

                    // Next Ayah Button
                    if (ayah < totalAyahs) {
                        document.getElementById('nextAyahBtn').onclick = () => {
                            window.location.href = `ayah_detail.html?surah=${surah}&ayah=${ayah + 1}`;
                        };
                    } else {
                        document.getElementById('nextAyahBtn').classList.add('hidden');
                    }

                    loading.classList.add('hidden');
                    content.classList.remove('hidden');

                    // Load initial Tafsir
                    loadTafsirContent(currentTafsir, document.querySelector('.tafsir-tab.active'));
                }
            } catch (e) {
                console.error(e);
                loading.innerHTML = '<p class="text-red-500">حدث خطأ في تحميل البيانات</p>';
            }
        }

        window.loadTafsirContent = async function (edition, btnEl) {
            if (btnEl) {
                document.querySelectorAll('.tafsir-tab').forEach(t => t.classList.remove('active'));
                btnEl.classList.add('active');
            }

            const tafsirBox = document.getElementById('tafsirContent');
            tafsirBox.innerHTML = '<span class="opacity-50">جاري التحميل...</span>';

            try {
                // استخدام AlQuran.cloud API مباشرة - يحتوي على جميع التفاسير العربية
                const apiUrl = `https://api.alquran.cloud/v1/ayah/${surah}:${ayah}/${edition}`;

                const res = await fetch(apiUrl);
                const data = await res.json();

                console.log('Tafsir API Response:', data); // للتشخيص

                if (data.code === 200 && data.data && data.data.text) {
                    tafsirBox.innerHTML = data.data.text;
                } else {
                    tafsirBox.innerHTML = '<span class="text-amber-600">التفسير غير متوفر لهذه الآية حالياً</span>';
                }
            } catch (e) {
                console.error('Tafsir fetch error:', e);
                tafsirBox.innerHTML = '<span class="text-red-400">خطأ في الاتصال بالخادم - حاول مرة أخرى</span>';
            }
        }

        // Audio Controls
        const progressContainer = document.getElementById('progressContainer');
        const progressBar = document.getElementById('progressBar');
        const currentTimeEl = document.getElementById('currentTime');
        const durationEl = document.getElementById('duration');
        const replayBtn = document.getElementById('replayBtn');

        // Format time helper
        function formatTime(seconds) {
            if (isNaN(seconds)) return '0:00';
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        // Play/Pause
        playBtn.onclick = () => {
            if (audio.paused) {
                audio.play().catch(err => {
                    console.error('Audio play error:', err);
                    alert('خطأ في تشغيل الصوت. تأكد من الاتصال بالإنترنت.');
                });
                updatePlayIcon(true);
            } else {
                audio.pause();
                updatePlayIcon(false);
            }
        };

        // Replay
        replayBtn.onclick = () => {
            audio.currentTime = 0;
            audio.play();
            updatePlayIcon(true);
        };

        // Progress bar click
        progressContainer.onclick = (e) => {
            const rect = progressContainer.getBoundingClientRect();
            const clickX = e.clientX - rect.left;
            const percentage = clickX / rect.width;
            audio.currentTime = percentage * audio.duration;
        };

        // Update duration when audio is loaded
        audio.onloadedmetadata = () => {
            durationEl.textContent = formatTime(audio.duration);
        };

        audio.onerror = () => {
            console.error('Audio loading error');
            alert('فشل تحميل الصوت. تأكد من الاتصال بالإنترنت.');
            updatePlayIcon(false);
        };

        audio.onended = () => updatePlayIcon(false);

        audio.ontimeupdate = () => {
            const percent = (audio.currentTime / audio.duration) * 100;
            progressBar.style.width = `${percent}%`;
            currentTimeEl.textContent = formatTime(audio.currentTime);
        };

        function updatePlayIcon(isPlaying) {
            if (isPlaying) {
                document.getElementById('playIcon').classList.add('hidden');
                document.getElementById('pauseIcon').classList.remove('hidden');
            } else {
                document.getElementById('playIcon').classList.remove('hidden');
                document.getElementById('pauseIcon').classList.add('hidden');
            }
        }

        // ====== Surah Selector Dropdown ======
        const surahSelectorBtn = document.getElementById('surahSelectorBtn');
        const surahDropdown = document.getElementById('surahDropdown');
        const surahDropdownArrow = document.getElementById('surahDropdownArrow');
        const surahSearch = document.getElementById('surahSearch');
        const surahList = document.getElementById('surahList');

        // Populate Surah List
        function populateSurahList(filter = '') {
            surahList.innerHTML = '';
            surahs.forEach((name, index) => {
                const surahNum = index + 1;
                const displayText = `${surahNum.toLocaleString('ar-EG')}. سورة ${name}`;

                if (filter && !name.includes(filter) && !displayText.includes(filter)) {
                    return;
                }

                const item = document.createElement('div');
                item.className = 'px-4 py-3 hover:bg-[#1B4332]/5 cursor-pointer transition-colors border-b border-gray-50 last:border-0 flex items-center gap-3';
                if (surahNum === surah) {
                    item.classList.add('bg-[#1B4332]/10');
                }

                item.innerHTML = `
                    <span class="flex-shrink-0 w-8 h-8 bg-[#1B4332]/10 text-[#1B4332] rounded-full flex items-center justify-center text-sm font-bold">
                        ${surahNum.toLocaleString('ar-EG')}
                    </span>
                    <span class="flex-1 text-right font-semibold text-gray-700">سورة ${name}</span>
                `;

                item.onclick = () => {
                    window.location.href = `ayah_detail.html?surah=${surahNum}&ayah=1`;
                };

                surahList.appendChild(item);
            });

            if (surahList.children.length === 0) {
                surahList.innerHTML = '<div class="p-4 text-center text-gray-400">لا توجد نتائج</div>';
            }
        }

        // Toggle Surah Dropdown
        surahSelectorBtn.onclick = (e) => {
            e.stopPropagation();
            const isHidden = surahDropdown.classList.contains('hidden');

            if (isHidden) {
                // Close ayah dropdown if open
                ayahDropdown.classList.add('hidden');
                ayahDropdownArrow.style.transform = 'rotate(0deg)';

                surahDropdown.classList.remove('hidden');
                surahDropdownArrow.style.transform = 'rotate(180deg)';
                populateSurahList();
                surahSearch.value = '';
                surahSearch.focus();
            } else {
                surahDropdown.classList.add('hidden');
                surahDropdownArrow.style.transform = 'rotate(0deg)';
            }
        };

        // Search Surah
        surahSearch.oninput = (e) => {
            populateSurahList(e.target.value);
        };

        // ====== Ayah Selector Dropdown ======
        const ayahSelectorBtn = document.getElementById('ayahSelectorBtn');
        const ayahDropdown = document.getElementById('ayahDropdown');
        const ayahDropdownArrow = document.getElementById('ayahDropdownArrow');
        const ayahList = document.getElementById('ayahList');

        // Populate Ayah List
        function populateAyahList(totalAyahs) {
            ayahList.innerHTML = '';
            const ayahsPerRow = 10;
            let currentRow = null;

            for (let i = 1; i <= totalAyahs; i++) {
                if ((i - 1) % ayahsPerRow === 0) {
                    currentRow = document.createElement('div');
                    currentRow.className = 'flex gap-2 mb-2';
                    ayahList.appendChild(currentRow);
                }

                const ayahBtn = document.createElement('button');
                ayahBtn.className = `flex-1 px-3 py-2 rounded-lg border transition-all font-bold ${i === ayah
                    ? 'bg-[#1B4332] text-white border-[#1B4332]'
                    : 'bg-white text-gray-700 border-gray-200 hover:border-[#1B4332] hover:bg-[#1B4332]/5'
                    }`;
                ayahBtn.textContent = i.toLocaleString('ar-EG');
                ayahBtn.onclick = () => {
                    if (i !== ayah) {
                        window.location.href = `ayah_detail.html?surah=${surah}&ayah=${i}`;
                    }
                };

                currentRow.appendChild(ayahBtn);
            }
        }

        // Toggle Ayah Dropdown
        ayahSelectorBtn.onclick = (e) => {
            e.stopPropagation();
            const isHidden = ayahDropdown.classList.contains('hidden');

            if (isHidden) {
                // Close surah dropdown if open
                surahDropdown.classList.add('hidden');
                surahDropdownArrow.style.transform = 'rotate(0deg)';

                ayahDropdown.classList.remove('hidden');
                ayahDropdownArrow.style.transform = 'rotate(180deg)';
            } else {
                ayahDropdown.classList.add('hidden');
                ayahDropdownArrow.style.transform = 'rotate(0deg)';
            }
        };

        // Close dropdowns when clicking outside
        document.addEventListener('click', (e) => {
            if (!surahSelectorBtn.contains(e.target) && !surahDropdown.contains(e.target)) {
                surahDropdown.classList.add('hidden');
                surahDropdownArrow.style.transform = 'rotate(0deg)';
            }
            if (!ayahSelectorBtn.contains(e.target) && !ayahDropdown.contains(e.target)) {
                ayahDropdown.classList.add('hidden');
                ayahDropdownArrow.style.transform = 'rotate(0deg)';
            }
        });

        window.onload = init;
    </script>
</body>

</html>